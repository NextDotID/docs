"use strict";(self.webpackChunknext_id_doc=self.webpackChunknext_id_doc||[]).push([[6559],{3881:(e,n,i)=>{i.d(n,{R:()=>c,x:()=>d});var t=i(8101);const r={},s=t.createContext(r);function c(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),t.createElement(s.Provider,{value:n},e.children)}},6302:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>o,frontMatter:()=>c,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"rest-api/kvservice-api","title":"KVService API","description":"Entrypoint","source":"@site/docs/rest-api/kvservice-api.md","sourceDirName":"rest-api","slug":"/rest-api/kvservice-api","permalink":"/rest-api/kvservice-api","draft":false,"unlisted":false,"editUrl":"https://github.com/nextdotid/docs/edit/main/docs/rest-api/kvservice-api.md","tags":[],"version":"current","frontMatter":{"title":"KVService API"},"sidebar":"docs","previous":{"title":"Platforms supported by ProofService","permalink":"/rest-api/proofservice-platforms-supported"},"next":{"title":"FAQs","permalink":"/faq"}}');var r=i(5105),s=i(3881);const c={title:"KVService API"},d=void 0,l={},a=[{value:"Entrypoint",id:"entrypoint",level:3},{value:"Structure",id:"structure",level:3},{value:"About struct patching",id:"about-struct-patching",level:3},{value:"Group KV",id:"group-kv",level:2},{value:"Get current KV of a avatar [GET /v1/kv]",id:"query",level:3},{value:"Get signature payload for updating [POST /v1/kv/payload]",id:"payload",level:3},{value:"Apply a patch [POST /v1/kv]",id:"patch",level:3}];function h(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h3,{id:"entrypoint",children:"Entrypoint"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Online"}),(0,r.jsx)(n.th,{children:"Environment"}),(0,r.jsx)(n.th,{children:"Entrypoint"}),(0,r.jsx)(n.th,{children:"Healthcheck"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u2705"}),(0,r.jsx)(n.td,{children:"Staging"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.a,{href:"https://kv-service.nextnext.id",children:"https://kv-service.nextnext.id"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.a,{href:"https://kv-service.nextnext.id/healthz",children:"https://kv-service.nextnext.id/healthz"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u2705"}),(0,r.jsx)(n.td,{children:"Production"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.a,{href:"https://kv-service.next.id",children:"https://kv-service.next.id"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.a,{href:"https://kv-service.next.id/healthz",children:"https://kv-service.next.id/healthz"})})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"structure",children:"Structure"}),"\n",(0,r.jsxs)(n.p,{children:["All requests and responses should be ",(0,r.jsx)(n.code,{children:"Content-Type: application/json"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"about-struct-patching",children:"About struct patching"}),"\n",(0,r.jsxs)(n.p,{children:["We choose ",(0,r.jsx)(n.a,{href:"https://www.rfc-editor.org/rfc/rfc7396",children:"RFC 7396"})," standard for\nKV modifying."]}),"\n",(0,r.jsx)(n.p,{children:"Client should choose a lib which implements this."}),"\n",(0,r.jsxs)(n.p,{children:["e.g.\n",(0,r.jsx)(n.a,{href:"https://github.com/pierreinglebert/json-merge-patch",children:"json-merge-patch"}),"\nfor JavaScript, ",(0,r.jsx)(n.a,{href:"https://github.com/idubrov/json-patch",children:"json-patch"}),"\nfor Rust."]}),"\n",(0,r.jsx)(n.h2,{id:"group-kv",children:"Group KV"}),"\n",(0,r.jsx)(n.h3,{id:"query",children:"Get current KV of a avatar [GET /v1/kv]"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Request (application/json)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Parameters"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["avatar (string, required) - Avatar public key (hexstring started with ",(0,r.jsx)(n.code,{children:"0x"}),")."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Example"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"GET /v1/kv?avatar=0x04c7cacde73af939c35d527b34e0556ea84bab27e6c0ed7c6c59be70f6d2db59c206b23529977117dc8a5d61fa848f94950422b79d1c142bcf623862e49f9e6575"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Response 200 (application/json)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Attributes (object)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["avatar (string, required) - Avatar public key (uncompressed hexstring started with ",(0,r.jsx)(n.code,{children:"0x"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:["proofs (array[object], required) - All proofs belong to this avatar","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["platform (string, required) - Platform (incl. ",(0,r.jsx)(n.code,{children:"nextid"}),", which means public key itself)."]}),"\n",(0,r.jsx)(n.li,{children:"identity (string, required) - Identity."}),"\n",(0,r.jsx)(n.li,{children:"content (object, required) - KV-pair of this entry."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Body"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'    {\n      "avatar": "0x04c7cacde73af939c35d527b34e0556ea84bab27e6c0ed7c6c59be70f6d2db59c206b23529977117dc8a5d61fa848f94950422b79d1c142bcf623862e49f9e6575",\n      "proofs": [{\n        "platform": "nextid",\n        "identity": "0x04c7cacde73.....",\n        "content": {\n          "this": "is",\n          "a": ["sample", "kv", "content"]\n        }\n      }, {\n        "platform": "twitter",\n        "identity": "yeiwb",\n        "content": {\n          "twitter": "only",\n          "kv": ["content", "goes", "here"]\n        }\n      }]\n    }\n'})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Response 404 (application/json)"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Persona not found (no KV was ever created)."}),"\n",(0,r.jsx)(n.h3,{id:"payload",children:"Get signature payload for updating [POST /v1/kv/payload]"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["Make sure to save order-aware struct in ",(0,r.jsx)(n.code,{children:"[]"})," value."]}),"\n"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Request (application/json)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Attributes (object)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["avatar (string, required) - Avatar public key (both comressed / uncompressed and with/without ",(0,r.jsx)(n.code,{children:"0x"})," are OK)."]}),"\n",(0,r.jsxs)(n.li,{children:["platform (string, required) - Platform (incl. ",(0,r.jsx)(n.code,{children:"nextid"}),", which means public key itself)."]}),"\n",(0,r.jsx)(n.li,{children:"identity (string, required) - Identity."}),"\n",(0,r.jsx)(n.li,{children:"patch (object, required) - Patch to current data"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Body"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n      "avatar": "0x04c7cacde73af939c35d527b34e0556ea84bab27e6c0ed7c6c59be70f6d2db59c206b23529977117dc8a5d61fa848f94950422b79d1c142bcf623862e49f9e6575",\n      "platform": "nextid",\n      "identity": "0x04c7cacde73af939c35d527b34e0556ea84bab27e6c0ed7c6c59be70f6d2db59c206b23529977117dc8a5d61fa848f94950422b79d1c142bcf623862e49f9e6575",\n      "patch": {\n          "this": "is",\n          "a": "sample",\n          "structure": ["it", "could", "be", "anything"],\n          "key": {\n            "to": {\n              "delete": null\n            }\n          }\n        }\n    }\n'})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Response 200 (application/json)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Attributes (body)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["uuid (string, required) - UUID for this patch action. Send this UUID in ",(0,r.jsx)(n.code,{children:"POST /v1/kv"})," as-is."]}),"\n",(0,r.jsxs)(n.li,{children:["created_at (number, required) - Creation timestamp of this request. Send this in ",(0,r.jsx)(n.code,{children:"POST /v1/kv"})," as-is."]}),"\n",(0,r.jsx)(n.li,{children:"sign_payload (string, required) - String to sign to."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Body"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'    {\n      "uuid": "40c13c92-31e5-40d1-aebb-143d8e5b9c5e",\n      "created_at": 1646983606,\n      "sign_payload": "{\\"action\\":\\"kv\\",\\"created_at\\":1646983606,\\"patch\\":{\\"a\\":\\"sample\\",\\"key_to_delete\\":null,\\"structure\\":[\\"it\\",\\"could\\",\\"be\\",\\"anything\\"],\\"this\\":\\"is\\"},\\"prev\\":null,\\"uuid\\":\\"40c13c92-31e5-40d1-aebb-143d8e5b9c5e\\"}"\n    }\n'})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"patch",children:"Apply a patch [POST /v1/kv]"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Request (application/json)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Attributes (object)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"avatar (string, required) - Avatar public key (hexstring, both comressed / uncompressed are OK)."}),"\n",(0,r.jsxs)(n.li,{children:["platform (string, required) - Platform (incl. ",(0,r.jsx)(n.code,{children:"nextid"}),", which means public key itself)."]}),"\n",(0,r.jsx)(n.li,{children:"identity (string, required) - Identity."}),"\n",(0,r.jsxs)(n.li,{children:["uuid (string, required) - UUID given by ",(0,r.jsx)(n.code,{children:"POST /v1/kv/payload"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["created_at (number, required) - Creation timestamp given by ",(0,r.jsx)(n.code,{children:"POST /v1/kv/payload"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"signature (string, required) - Signature of this request. Base64-ed."}),"\n",(0,r.jsx)(n.li,{children:"patch (object, required) - Patch content"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Body"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'    {\n      "avatar": "0x04c7cacde73af939c35d527b34e0556ea84bab27e6c0ed7c6c59be70f6d2db59c206b23529977117dc8a5d61fa848f94950422b79d1c142bcf623862e49f9e6575",\n      "platform": "nextid",\n      "identity": "0x04c7cacde73af939c35d527b34e0556ea84bab27e6c0ed7c6c59be70f6d2db59c206b23529977117dc8a5d61fa848f94950422b79d1c142bcf623862e49f9e6575",\n      "uuid": "40c13c92-31e5-40d1-aebb-143d8e5b9c5e",\n      "created_at": 1646983606,\n      "signature": "BASE64_SIGNATURE_HERE",\n      "patch": {\n          "this": "is",\n          "a": "sample",\n          "structure": ["it", "could", "be", "any", "JSON"],\n          "key": {\n            "to": {\n              "delete": null\n            }\n          }\n        }\n    }\n'})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Response 201 (application/json)"}),"\n",(0,r.jsxs)(n.p,{children:["Created successfully. Response is same as ",(0,r.jsx)(n.code,{children:"GET /v1/kv"}),"."]}),"\n"]}),"\n"]})]})}function o(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}}}]);